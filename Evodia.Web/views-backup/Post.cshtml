@using Umbraco.Web
@using Evodia.Core.Utility
@inherits UmbracoViewPage<IPublishedContent>
@{
    Layout = "MasterBlog.cshtml";

    var ci = new System.Globalization.CultureInfo("en-GB");
    System.Threading.Thread.CurrentThread.CurrentCulture = ci;
    System.Threading.Thread.CurrentThread.CurrentUICulture = ci;

    var homePage = Model.AncestorOrSelf(1);
    var blog = homePage.Descendants("blog").First();
    var allPosts = blog.Descendants("posts").First().Descendants().OrderBy("releaseDate desc");

    string headline = Model.HasValue("headline") ? Model.GetPropertyValue<string>("headline") : Model.Name;
    DateTime releaseDate = Model.GetPropertyValue<DateTime>("releaseDate");
    string excerpt = Model.GetPropertyValue<string>("excerpt");

    bool hasAuthor = Model.HasValue("author");
    bool hasCategory = Model.HasValue("category");
}

<article class="c-article" itemscope itemtype="http://schema.org/BlogPosting">
    <header class="c-article__header">
        <h1 class="c-article__heading" itemprop="headline">@headline</h1>
        <ul class="c-meta-data">
            <li class="c-meta-data__item">
                <time datetime="@releaseDate" pubdate="pubdate">
                    @releaseDate.ToString("%d")<sup>@Helpers.GetDaySuffix(releaseDate.ToString("%d"))</sup> @releaseDate.ToString("MMMM yyyy")
                </time>
                <meta itemprop="datePublished" content="@releaseDate.ToString("yyyy-MM-dd")">
            </li>
            @if( hasAuthor )
            {
                var authorId = Model.GetPropertyValue<string>("author");
                var authorPage = Umbraco.TypedContent(authorId);

                <li class="c-meta-data__item u-hide-mobile" itemprop="author">
                    <a href="@authorPage.Url" rel="author">@authorPage.Name</a>
                </li>
            }
            @if( hasCategory )
            {
                var categoryId = Model.GetPropertyValue<string>("category");
                var categoryPage = Umbraco.TypedContent(categoryId);

                <li class="c-meta-data__item" itemprop="keywords">
                    <a href="@categoryPage.Url" rel="category">@categoryPage.Name</a>
                </li>
            }
        </ul>
    </header>

    <div class="s-free-content u-clearfix" itemprop="articleBody">
        <div class="c-article__description u-intro" itemprop="description">
            <p>@excerpt</p>
        </div>
        @Html.Partial("~/Views/Partials/PageComponents/PageComponents.cshtml")
    </div>
</article>

@Html.Partial("~/Views/Partials/Blog/RelatedPosts.cshtml")
@Html.Partial("~/Views/Partials/Components/Comments.cshtml")


@section Sidebar {
   @Html.Partial("~/Views/Partials/Blog/BlogCategories.cshtml")
   @Html.Partial("~/Views/Partials/Components/BlogNewsArchive.cshtml", allPosts.ToList())
}
